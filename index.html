<!DOCTYPE html><html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Karaoke Web – Tempel Lirik "Perfect"</title>
  <style>
    :root{--bg:#0f1221;--card:#171a2f;--text:#e9ecff;--muted:#9aa0c3;--accent:#7aa2ff;--accent-2:#a97aff}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#0b0e1a, #141836 60%, #0b0e1a);color:var(--text)}
    header{padding:24px 20px;text-align:center}
    header h1{margin:0;font-size:clamp(20px,3.2vw,28px);letter-spacing:.2px}
    header p{margin:6px 0 0;color:var(--muted)}.container{max-width:1000px;margin:0 auto;padding:16px}
.grid{display:grid;grid-template-columns:1fr;gap:16px}
@media(min-width:900px){.grid{grid-template-columns:1.2fr .8fr}}

.card{background:rgba(23,26,47,.7);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.06);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
.card h2{margin:0 0 12px;font-size:18px;color:#fff}
.card .content{padding:18px}

.controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
.controls label{font-size:14px;color:var(--muted)}
.controls input[type="number"], .controls input[type="text"], .controls input[type="url"]{
  background:#0f1328;border:1px solid rgba(255,255,255,.1);color:#fff;border-radius:10px;padding:10px 12px;outline:none;min-width:120px
}
.btn{appearance:none;border:none;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:white;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;transition:transform .05s ease}
.btn:active{transform:translateY(1px)}
.btn.secondary{background:#0f1328;border:1px solid rgba(255,255,255,.12)}

.lyrics{height:60vh;overflow:auto;padding:6px 10px;border-radius:14px;background:#0b0f24;border:1px solid rgba(255,255,255,.06)}
.line{padding:10px 12px;margin:6px 0;border-radius:12px;color:#cfd5ff;opacity:.7;transition:opacity .2s, background .2s}
.line:hover{background:rgba(255,255,255,.03);opacity:.9;cursor:pointer}
.line.active{background:linear-gradient(90deg,rgba(122,162,255,.18),rgba(169,122,255,.12));opacity:1;border-left:4px solid var(--accent)}
.timestamp{font-size:12px;color:var(--muted);margin-right:8px}

textarea#lrc{width:100%;min-height:260px;resize:vertical;background:#0b0f24;color:#e9ecff;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
.hint{font-size:12px;color:var(--muted)}

footer{padding:18px;text-align:center;color:var(--muted);font-size:12px}

  </style>
</head>
<body>
  <header>
    <h1>Karaoke Web – Tempel Lirik "Perfect" (Ed Sheeran)</h1>
    <p>Putar audio, tempel lirik format <strong>LRC</strong>, atur offset supaya sinkron 🎶</p>
  </header>  <div class="container">
    <div class="grid">
      <!-- LEFT: Player + Synced View -->
      <section class="card">
        <div class="content">
          <h2>1) Pemutar & Tampilan Lirik</h2>
          <div class="controls" style="margin-bottom:12px">
            <label>File/URL Audio (mp3): </label>
            <input id="audioUrl" type="url" placeholder="Tempel URL mp3 di sini atau pilih file di kanan" />
            <input id="audioFile" type="file" accept="audio/*" class="btn secondary" />
            <button id="loadAudio" class="btn">Muat Audio</button>
          </div>
          <audio id="audio" controls style="width:100%" src="perfect.mp3"></audio><div class="controls" style="margin-top:14px">
        <label for="offset">Offset global (ms, + lambat / – cepat):</label>
        <input id="offset" type="number" value="0" step="50" />
        <button id="applyOffset" class="btn secondary">Terapkan</button>
        <button id="scrollToCurrent" class="btn secondary">Lompat ke baris aktif</button>
      </div>

      <div id="lyrics" class="lyrics" aria-live="polite" style="margin-top:12px"></div>
    </div>
  </section>

  <!-- RIGHT: Editor -->
  <section class="card">
    <div class="content">
      <h2>2) Editor LRC</h2>
      <textarea id="lrc" spellcheck="false" placeholder="Contoh format LRC:\n[mm:ss.xx] Teks lirik\nBisa banyak timestamp di satu baris: [00:05.00][00:10.00] Baris yang sama\n\n👉 Tempel lirik 'Perfect' yang Anda miliki secara legal di sini, lalu klik 'Muat LRC'.\n\nTemplate kosong:\n[00:05.00] [Intro]\n[00:15.00] [Verse 1]\n[00:45.00] [Pre-Chorus]\n[01:00.00] [Chorus]\n[01:30.00] [Verse 2]\n[02:15.00] [Chorus]\n[02:45.00] [Bridge]\n[03:10.00] [Final Chorus]\n"></textarea>
      <div class="controls" style="margin-top:10px">
        <button id="loadLrc" class="btn">Muat LRC</button>
        <button id="clearLrc" class="btn secondary">Bersihkan</button>
      </div>
      <p class="hint" style="margin-top:10px">
        Tips cepat: kalau lirik telat ~300 ms, isi offset <strong>-300</strong> (minus). Kalau lirik kepagian, isi <strong>+300</strong>.
      </p>
    </div>
  </section>
</div>

  </div>  <footer>
    Buat untuk keperluan edukasi & latihan sinkronisasi lirik. Tempel lirik yang Anda miliki haknya.
  </footer>  <script>
    // ===== Utilities =====
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));

    function parseTimeTag(t){
      // mm:ss.xx or mm:ss or h:mm:ss.xx
      const m = t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(?:\.(\d{1,3}))?$/);
      if(!m) return null;
      const h = +(m[1]||0), mm = +m[2], ss = +m[3], ms = +(m[4]||0);
      return h*3600 + mm*60 + ss + ms/1000;
    }

    function parseLRC(text){
      const lines = text.split(/\r?\n/);
      /** @type {{time:number,text:string}[]} */
      const out = [];
      for(const raw of lines){
        if(!raw.trim()) continue;
        const tags = Array.from(raw.matchAll(/(\d{1,2}:\d{2}:\d{2}(?:\.\d{1,3})?|\d{2}:\d{2}(?:\.\d{1,3})?)/g));
        const content = raw.replace(/^(?:[^]+\])+\s*/, "");
        for(const tg of tags){
          const sec = parseTimeTag(tg[1]);
          if(sec!=null){ out.push({time:sec, text:content}); }
        }
      }
      // sort & dedupe by time
      out.sort((a,b)=>a.time-b.time);
      const dedup = [];
      const seen = new Set();
      for(const it of out){
        const key = it.time.toFixed(3)+"\u0000"+it.text;
        if(!seen.has(key)){ seen.add(key); dedup.push(it); }
      }
      return dedup;
    }

    // ===== State =====
    let lrcData = [];
    let offsetMs = 0;

    // ===== DOM Refs =====
    const audio = $('#audio');
    const audioUrl = $('#audioUrl');
    const audioFile = $('#audioFile');
    const loadAudioBtn = $('#loadAudio');
    const offsetInput = $('#offset');
    const applyOffsetBtn = $('#applyOffset');
    const lyricsBox = $('#lyrics');
    const lrcTextarea = $('#lrc');
    const loadLrcBtn = $('#loadLrc');
    const clearLrcBtn = $('#clearLrc');
    const scrollBtn = $('#scrollToCurrent');

    // ===== Rendering =====
    function formatTS(sec){
      const s = Math.max(sec,0);
      const m = Math.floor(s/60); const r = s-m*60; const ss = Math.floor(r).toString().padStart(2,'0');
      const ms = Math.round((r-Math.floor(r))*1000).toString().padStart(3,'0');
      return `${m}:${ss}.${ms}`;
    }

    function renderLyrics(){
      lyricsBox.innerHTML = '';
      for(const row of lrcData){
        const div = document.createElement('div');
        div.className = 'line';
        div.dataset.time = row.time;
        div.innerHTML = `<span class="timestamp">[${formatTS(row.time)}]</span> ${row.text ? escapeHtml(row.text) : '<em>(baris kosong)</em>'}`;
        div.addEventListener('click', ()=>{ audio.currentTime = Math.max(0, row.time + offsetMs/1000 - 0.01); audio.play(); });
        lyricsBox.appendChild(div);
      }
    }

    function escapeHtml(s){
      return s.replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[c]));
    }

    function updateActiveLine(){
      if(!lrcData.length) return;
      const t = audio.currentTime + offsetMs/1000;
      // find the last index whose time <= t
      let lo=0, hi=lrcData.length-1, idx=0;
      while(lo<=hi){
        const mid = (lo+hi)>>1;
        if(lrcData[mid].time <= t){ idx = mid; lo = mid+1; } else { hi = mid-1; }
      }
      $$('.line', lyricsBox).forEach((el,i)=>{
        el.classList.toggle('active', i===idx);
      });
      const active = $$('.line', lyricsBox)[idx];
      if(active){
        const box = lyricsBox;
        const aTop = active.offsetTop; const aBot = aTop + active.offsetHeight;
        const vTop = box.scrollTop; const vBot = vTop + box.clientHeight;
        if(aTop < vTop + 80){ box.scrollTo({top: aTop - 80, behavior:'smooth'}); }
        else if(aBot > vBot - 80){ box.scrollTo({top: aBot - box.clientHeight + 80, behavior:'smooth'}); }
      }
    }

    // ===== Events =====
    audio.addEventListener('timeupdate', updateActiveLine);
    audio.addEventListener('seeked', updateActiveLine);
    audio.addEventListener('loadeddata', ()=>{ updateActiveLine(); });

    loadAudioBtn.addEventListener('click', ()=>{
      if(audioFile.files && audioFile.files[0]){
        const url = URL.createObjectURL(audioFile.files[0]);
        audio.src = url;
      } else if(audioUrl.value.trim()){
        audio.src = audioUrl.value.trim();
      } else {
        alert('Pilih file audio atau tempel URL mp3 terlebih dahulu.');
      }
      audio.play().catch(()=>{});
    });

    applyOffsetBtn.addEventListener('click', ()=>{
      const v = Number(offsetInput.value||0);
      if(Number.isFinite(v)){
        offsetMs = v|0;
        updateActiveLine();
      }
    });

    scrollBtn.addEventListener('click', ()=> updateActiveLine());

    loadLrcBtn.addEventListener('click', ()=>{
      lrcData = parseLRC(lrcTextarea.value||'');
      if(!lrcData.length){
        alert('LRC kosong atau belum ada timestamp. Contoh: [00:12.50] Teks lirik');
      }
      renderLyrics();
      updateActiveLine();
    });

    clearLrcBtn.addEventListener('click', ()=>{
      lrcTextarea.value = '';
      lrcData = [];
      lyricsBox.innerHTML = '';
    });

    // ===== Demo minimal (tidak berhak cipta) =====
    const demo = [
      '[00:05.00] Contoh baris (ganti dengan lirik Anda)',
      '[00:10.00] Baris berikutnya untuk uji sinkronisasi',
      '[00:15.00] Tekan baris untuk lompat waktu'
    ].join('\n');
    lrcTextarea.value = demo;
    lrcData = parseLRC(demo);
    renderLyrics();
  </script></body>
</html>
